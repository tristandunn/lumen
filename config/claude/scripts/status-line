#!/usr/bin/env bash

#
# Custom status line script.
#

LIGHT_BLUE="\e[94m"
LIGHT_GREEN="\e[92m"
RESET="\e[0m"

# Read JSON input from stdin.
input=$(cat)

# Extract current directory.
cwd=$(echo "$input" | jq -r '.workspace.current_dir')

# Get the branch name.
branch=$(cd "$cwd" 2>/dev/null && git branch --show-current 2>/dev/null)

# Replace the $HOME path with a tilde.
cwd="${cwd/#$HOME/\~}"

# Add the directory.
output=""
output="${output}$(printf "${LIGHT_BLUE}%s${RESET}" "$cwd")"

# Add the branch, when present.
if [ -n "$branch" ]; then
  output="${output} on $(printf "${LIGHT_GREEN}%s${RESET}" "$branch")"
fi

# Display the status line.
echo -e "$output"
