#!/usr/bin/env bash

set -euo pipefail

declare -A SHORTCUTS=(
  [default:copy]="SHIFT+CONTROL,C"
  [default:paste]="SHIFT+CONTROL,V"
  [default:save]="CONTROL,S"
  [default:tab-close]="killactive"
  [default:toggle-float]="toggle-float"
  [firefox:reload]="CONTROL,R"
  [firefox:tab-close]="CONTROL,W"
  [firefox:tab-goto-number]="ALT"
  [firefox:tab-new]="CONTROL,T"
  [firefox:tab-next]="CONTROL,TAB"
  [firefox:tab-previous]="SHIFT+CONTROL,TAB"
  [kitty:tab-close]="SHIFT+CONTROL,W"
  [kitty:tab-new]="SHIFT+CONTROL,T"
  [kitty:tab-next]="SHIFT+CONTROL,RIGHT"
  [kitty:tab-previous]="SHIFT+CONTROL,LEFT"
)

action=$1
param=${2:-}
class=$(hyprctl activewindow -j | jq -r '.class')
address="0x$(hyprctl activewindow | head -n 1 | awk '{print $2}')"
shortcut="${SHORTCUTS[$class:$action]:-${SHORTCUTS[default:$action]}}"

if [[ -z "$shortcut" ]]; then
  exit 1
elif [[ "$shortcut" == "killactive" ]]; then
  hyprctl dispatch killactive
elif [[ "$shortcut" == "toggle-float" ]]; then
  window_info=$(hyprctl activewindow -j)
  floating=$(echo "$window_info" | jq -r '.floating')
  workspace=$(echo "$window_info" | jq -r '.workspace.name')

  hyprctl dispatch togglefloating
  hyprctl dispatch movetoworkspace "$workspace"

  if [[ "$floating" == "false" ]]; then
    hyprctl dispatch resizeactive exact 80% 80%
    hyprctl dispatch centerwindow
  fi
elif [[ -n "$param" ]]; then
  hyprctl dispatch sendshortcut "$shortcut", "$param", address:"$address"
else
  hyprctl dispatch sendshortcut "$shortcut", address:"$address"
fi
